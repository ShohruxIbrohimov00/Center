{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="max-w-4xl mx-auto p-4 md:p-8">
    <div class="card-section">
        <h1 class="card-title">Mavzulanmagan savollar</h1>
        
        {% for question in questions %}
            <div class="card-section mb-4 p-4 border rounded-md">
                <p>{{ forloop.counter }}. {{ question.text|safe }}</p>
                <button class="add-question-btn btn btn-primary mt-4" data-question-id="{{ question.id }}">
                    Tanlash
                </button>
            </div>
        {% empty %}
            <p class="text-gray-600">Savollar topilmadi.</p>
        {% endfor %}
        
        <div class="mt-8 flex justify-end">
            <a href="{% url 'create_static_exam_step2' exam_id=exam_id %}" class="btn btn-secondary">
                Orqaga qaytish
            </a>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        const sectionIndex = "{{ section_index }}";
        const examId = "{{ exam_id }}"; // <--- JavaScriptga exam_id ni uzatamiz

        document.querySelectorAll('.add-question-btn').forEach(button => {
            button.addEventListener('click', function() {
                const questionId = this.dataset.questionId;
                
                fetch(`/create-static/step-2/${examId}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    },
                    body: JSON.stringify({
                        action: 'add_question',
                        section_index: sectionIndex,
                        question_id: questionId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        alert(data.message);
                        this.textContent = 'Tanlandi';
                        this.disabled = true;
                        this.classList.remove('btn-primary');
                        this.classList.add('bg-green-500');
                    } else {
                        alert(data.message);
                    }
                })
                .catch(error => console.error('Error adding question:', error));
            });
        });
    });
</script>
{% endblock %}